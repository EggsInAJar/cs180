<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS180 Project 3: Image Mosaicing and Image Warping</title>
    <link rel="stylesheet" href="project3_styles.css">
</head>
<body>
    <div class="container">
    <h1>CS180 Project 3: Image Mosaicing and Image Warping</h1>
        <p style="text-align: center; font-size: 1.25rem; color: #64748b; margin-bottom: 40px;">
            <strong>Author:</strong> Merrick Zheng | <strong>Date:</strong> Fall 2025
        </p>

    <!-- Part A.1: Shoot Pictures -->
    <div class="section">
        <h2>Part A.1: Shoot and Digitize Pictures</h2>
        <p>I captured multiple sets of images with projective transformations by fixing the center of projection and rotating the camera. Each set has 40-70% overlap for robust registration.</p>
        
        <h3>Mosaic Image Sets</h3>
        <div class="image-row">
            <div class="image-item">
                <img src="imgs/Mosaic1a.PNG" alt="Mosaic Set 1a">
                <div class="caption">Mosaic Set 1 - Image A</div>
            </div>
            <div class="image-item">
                <img src="imgs/Mosaic1b.PNG" alt="Mosaic Set 1b">
                <div class="caption">Mosaic Set 1 - Image B</div>
            </div>
        </div>
        
        <div class="image-row">
            <div class="image-item">
                <img src="imgs/Mosaic2a.PNG" alt="Mosaic Set 2a">
                <div class="caption">Mosaic Set 2 - Image A</div>
            </div>
            <div class="image-item">
                <img src="imgs/Mosaic2b.PNG" alt="Mosaic Set 2b">
                <div class="caption">Mosaic Set 2 - Image B</div>
            </div>
        </div>
        
        <div class="image-row">
            <div class="image-item">
                <img src="imgs/Mosaic3a.PNG" alt="Mosaic Set 3a">
                <div class="caption">Mosaic Set 3 - Image A</div>
            </div>
            <div class="image-item">
                <img src="imgs/Mosaic3b.PNG" alt="Mosaic Set 3b">
                <div class="caption">Mosaic Set 3 - Image B</div>
            </div>
        </div>

        <h3>Image Set 2: Rectification Images</h3>
        <div class="image-row">
            <div class="image-item">
                <img src="imgs/Warp1.jpg" alt="Warp 1">
                <div class="caption">Warp Image 1</div>
            </div>
            <div class="image-item">
                <img src="imgs/Warp2.jpg" alt="Warp 2">
                <div class="caption">Warp Image 2</div>
            </div>
        </div>
    </div>

    <!-- Part A.2: Recover Homographies -->
    <div class="section">
        <h2>Part A.2: Recover Homographies</h2>
        
        <h3>Implementation</h3>
        <p>I implemented <code>computeH(im1_pts, im2_pts)</code> to recover the 3×3 homography matrix using least-squares.</p>
        
        <div class="highlight">
            <strong>Algorithm:</strong>
            <ol>
                <li>Set up overdetermined system Ah = b with 2n equations for n point pairs</li>
                <li>Each point (x₁,y₁) → (x₂,y₂) gives 2 equations</li>
                <li>Solve using <code>np.linalg.lstsq</code> for robustness</li>
                <li>Construct 3×3 matrix H with h₂₂ = 1</li>
            </ol>
        </div>

        <h3>Point Correspondences</h3>
        <div class="image-container">
            <img src="imgs/correspondences_viz.png" alt="Point Correspondences" style="max-width: 95%;">
            <div class="caption">Point correspondences between images (numbered 1-6+)</div>
        </div>

        <h3>System of Equations: Ah = b</h3>
        
        <p><strong>Equation formulation:</strong> For each point correspondence (x₁,y₁) → (x₂,y₂):</p>
        <ul>
            <li>x₂ = (h₀x₁ + h₁y₁ + h₂) / (h₆x₁ + h₇y₁ + 1)</li>
            <li>y₂ = (h₃x₁ + h₄y₁ + h₅) / (h₆x₁ + h₇y₁ + 1)</li>
        </ul>
        <p>With n point pairs, we have 2n equations for 8 unknowns (h₀-h₇). Least-squares finds the best fit homography.</p>

        <h3>Recovered Homography Matrix</h3>
        <p>The homography matrix H is a 3×3 matrix (8 degrees of freedom with h₂₂=1) that maps points from Image 1 to Image 2 via p' = Hp.</p>
        <pre>
H = [[ 1.358    -0.273   -599.067]
     [ 0.169     1.146   -133.718]
     [ 0.0003   -0.0002    1.000 ]]

Residual sum of squares: 2137.08 pixels²
Mean reprojection error: 16.32 pixels
        </pre>
    </div>

    <!-- Part A.3: Warp Images -->
    <div class="section">
        <h2>Part A.3: Warp the Images</h2>
        
        <h3>Implementation</h3>
        <p>I implemented two interpolation methods from scratch using inverse warping to avoid holes:</p>
        
        <table>
            <tr>
                <th>Method</th>
                <th>Description</th>
                <th>Speed</th>
                <th>Quality</th>
            </tr>
            <tr>
                <td><strong>Nearest Neighbor</strong></td>
                <td>Round coordinates to nearest pixel</td>
                <td>Fast</td>
                <td>Sharp edges, can be blocky</td>
            </tr>
            <tr>
                <td><strong>Bilinear</strong></td>
                <td>Weighted average of 4 neighboring pixels</td>
                <td>Slower</td>
                <td>Smoother, better for diagonal lines</td>
            </tr>
        </table>

        <h3>Rectification Examples</h3>
        <p>I tested the warping functions by rectifying images with known rectangular objects. The homography transforms distorted rectangles into perfect rectangles.</p>

        <h4>Rectification 1</h4>
        <div class="image-container">
            <img src="imgs/warp1_with_points.png" alt="Warp1 with points" style="max-width: 70%;">
            <div class="caption">Warp1 Original - 4 corners of rectangular region selected</div>
        </div>
        <div class="image-row">
            <div class="image-item">
                <img src="imgs/warp1_rectified_nn.png" alt="Warp1 NN">
                <div class="caption">Rectified - Nearest Neighbor</div>
            </div>
            <div class="image-item">
                <img src="imgs/warp1_rectified_bil.png" alt="Warp1 Bilinear">
                <div class="caption">Rectified - Bilinear</div>
            </div>
        </div>

        <h4>Rectification 2</h4>
        <div class="image-container">
            <img src="imgs/warp2_with_points.png" alt="Warp2 with points" style="max-width: 70%;">
            <div class="caption">Warp2 Original - 4 corners of rectangular region selected</div>
        </div>
        <div class="image-row">
            <div class="image-item">
                <img src="imgs/warp2_rectified_nn.png" alt="Warp2 NN">
                <div class="caption">Rectified - Nearest Neighbor</div>
            </div>
            <div class="image-item">
                <img src="imgs/warp2_rectified_bil.png" alt="Warp2 Bilinear">
                <div class="caption">Rectified - Bilinear</div>
            </div>
        </div>

        <div class="highlight">
            <strong>Comparison:</strong> Bilinear interpolation produces noticeably smoother results, especially visible in diagonal edges and curved features. Nearest neighbor is faster but can show aliasing artifacts. For high-quality mosaics, bilinear is preferred.
        </div>
    </div>

    <!-- Part A.4: Blend Images -->
    <div class="section">
        <h2>Part A.4: Blend Images into Mosaics</h2>
        
        <h3>Blending Algorithm</h3>
        <p>I implemented <strong>multi-resolution blending using Laplacian pyramids with distance transform masks</strong> to eliminate seam artifacts:</p>
        
        <div class="highlight">
            <strong>Multi-Resolution Blending Procedure:</strong>
            <ol>
                <li><strong>Distance Transform Masks:</strong> Create binary masks from valid pixels, apply distance transform to measure distance from edges, normalize to [0,1] for smooth falloff</li>
                <li><strong>Laplacian Pyramids:</strong> Decompose images into 4-level pyramids (frequency bands)</li>
                <li><strong>Gaussian Mask Pyramid:</strong> Create pyramid of blending masks</li>
                <li><strong>Pyramid Blending:</strong> At each level, blend using: blend[i] = img1[i] × mask + img2[i] × (1-mask)</li>
                <li><strong>Reconstruction:</strong> Reconstruct final image from blended pyramid</li>
                <li><strong>Cropping:</strong> Remove black borders automatically</li>
            </ol>
        </div>

        <p><strong>Why This Works:</strong> Low frequencies (smooth regions) blend gradually while high frequencies (details/textures) transition sharply. Distance transform ensures smooth weight falloff at edges. Result: seamless mosaics with no visible seams!</p>

        <h3>Mosaic 1: Indoor Scene</h3>
        
        <h4>Source Images</h4>
        <div class="image-row">
            <div class="image-item">
                <img src="imgs/mosaic_source_1.png" alt="Source 1">
                <div class="caption">Source Image 1</div>
            </div>
            <div class="image-item">
                <img src="imgs/mosaic_source_2.png" alt="Source 2">
                <div class="caption">Source Image 2 (Reference)</div>
            </div>
        </div>
        
        <h4>Mosaic Results</h4>
        <div class="image-row">
            <div class="image-item">
                <img src="imgs/mosaic_nn.png" alt="Mosaic NN">
                <div class="caption">Mosaic - Nearest Neighbor</div>
            </div>
            <div class="image-item">
                <img src="imgs/mosaic_bilinear.png" alt="Mosaic Bilinear">
                <div class="caption">Mosaic - Bilinear (Smoother)</div>
            </div>
        </div>

        <h3>Mosaic 2: Set 2</h3>
        <div class="image-container">
            <img src="imgs/mosaic_bilinear_1.png" alt="Mosaic 2" style="max-width: 90%;">
            <div class="caption">Mosaic 2 - Bilinear interpolation with multi-resolution blending</div>
        </div>

        <h3>Mosaic 3: Set 3</h3>
        <div class="image-container">
            <img src="imgs/mosaic_bilinear_2.png" alt="Mosaic 3" style="max-width: 90%;">
            <div class="caption">Mosaic 3 - Bilinear interpolation with multi-resolution blending</div>
        </div>
    </div>

    <!-- Part B: Automatic Mosaicing using MOPS -->
    <div class="section">
        <h2>Part B: Automatic Mosaicing using MOPS</h2>
        <p>Part B focuses on implementing the MOPS algorithm from Brown et al.'s paper "Multi-Image Matching using Multi-Scale Oriented Patches" to achieve automatic image mosaicing without manual point selection.</p>
        <p><strong>Implementation Overview:</strong> This section demonstrates a complete automatic mosaicing pipeline that eliminates the need for manual intervention. The MOPS algorithm automatically detects distinctive features, establishes correspondences between images, and estimates robust homographies using RANSAC to create seamless panoramic compositions.</p>
    </div>

    <!-- B.1: Harris Corner Detection with ANMS -->
    <div class="section">
        <h2>B.1: Harris Corner Detection with ANMS</h2>
        <p>The initial step in automatic mosaicing requires identifying reliable interest points within the images. This is accomplished through Harris corner detection, followed by Adaptive Non-Maximal Suppression (ANMS) to select the most distinctive corners.</p>
        
        <div class="highlight">
            <strong>Deliverables:</strong>
            <ul>
                <li>Show detected corners overlaid on image, with and without ANMS</li>
                <li>Demonstrate the effectiveness of ANMS in corner selection</li>
        </ul>
        </div>

        <h3>Harris Corner Detection Results</h3>
        <div class="image-container">
            <img src="imgs/Image 3aANS.png" alt="Harris Corners with ANMS">
            <div class="caption">Harris corners detected with ANMS for Image 3a</div>
        </div>
        
        <div class="image-container">
            <img src="imgs/Image 3bANS.png" alt="Harris Corners with ANMS">
            <div class="caption">Harris corners detected with ANMS for Image 3b</div>
        </div>
    </div>

    <!-- B.2: Feature Descriptor Extraction -->
    <div class="section">
        <h2>B.2: Feature Descriptor Extraction</h2>
        <p>Each detected corner requires a unique descriptor that can be reliably matched across different images. This is achieved by extracting 8x8 feature descriptors from 40x40 windows around each corner, followed by bias/gain normalization.</p>
        
        <div class="highlight">
            <strong>Deliverables:</strong>
            <ul>
                <li>Extract normalized 8x8 feature descriptors</li>
                <li>Show several extracted features</li>
        </ul>
        </div>

        <h3>Feature Descriptor Visualization</h3>
        <div class="image-container">
            <img src="imgs/Image 3aDescriptor.png" alt="Feature Descriptors">
            <div class="caption">Feature descriptors extracted from keypoints with 8x8 patches from 40x40 windows, showing normalized descriptors</div>
        </div>
    </div>

    <!-- B.3: Feature Matching using Lowe Ratio Test -->
    <div class="section">
        <h2>B.3: Feature Matching using Lowe Ratio Test</h2>
        <p>Feature matching between image pairs is accomplished using Lowe's ratio test to establish reliable correspondences while filtering out ambiguous matches.</p>
        
        <div class="highlight">
            <strong>Deliverables:</strong>
            <ul>
                <li>Show matched features between image pairs</li>
                <li>Demonstrate effectiveness of Lowe ratio test</li>
        </ul>
        </div>

        <h3>Feature Matching Results</h3>
        <div class="image-container">
            <img src="imgs/Image 1a ↔ Image 1bMatches.png" alt="Feature Matches 1">
            <div class="caption">Feature matches between Image 1a and Image 1b using Lowe ratio test</div>
        </div>
        
        <div class="image-container">
            <img src="imgs/Image 2a ↔ Image 2bMatches.png" alt="Feature Matches 2">
            <div class="caption">Feature matches between Image 2a and Image 2b using Lowe ratio test</div>
        </div>
        
        <div class="image-container">
            <img src="imgs/Image 3a ↔ Image 3bMatches.png" alt="Feature Matches 3">
            <div class="caption">Feature matches between Image 3a and Image 3b using Lowe ratio test</div>
        </div>
    </div>

    <!-- B.4: RANSAC for Robust Homography and Automatic Mosaics -->
    <div class="section">
        <h2>B.4: RANSAC for Robust Homography and Automatic Mosaics</h2>
        <p>Despite the filtering provided by the Lowe ratio test, some false matches inevitably remain. RANSAC (RANdom SAmple Consensus) is implemented to handle these outliers and create robust automatic mosaics.</p>
        
        <div class="highlight">
            <strong>Deliverables:</strong>
            <ul>
                <li>Implement 4-point RANSAC from scratch</li>
                <li>Show comparison of stitching manually and automatically</li>
                <li>Create ≥3 automatic mosaics</li>
            </ul>
        </div>

        <h3>RANSAC Results</h3>
        <div class="image-container">
            <img src="imgs/Image 1a ↔ Image 1bRANSAC.png" alt="RANSAC Matches 1">
            <div class="caption">RANSAC inlier matches for Image 1a ↔ Image 1b showing robust homography estimation</div>
        </div>
        
        <div class="image-container">
            <img src="imgs/Image 2a ↔ Image 2bRANSAC.png" alt="RANSAC Matches 2">
            <div class="caption">RANSAC inlier matches for Image 2a ↔ Image 2b showing robust homography estimation</div>
        </div>
        
        <div class="image-container">
            <img src="imgs/Image 3a ↔ Image 3bRANSAC.png" alt="RANSAC Matches 3">
            <div class="caption">RANSAC inlier matches for Image 3a ↔ Image 3b showing robust homography estimation</div>
        </div>

        <h3>Manual vs Automatic Stitching Comparison</h3>
        <p><strong>Direct visual comparison of manual vs automatic mosaicing for all three image pairs:</strong></p>

        <h4>Mosaic 1: Image 1a ↔ Image 1b</h4>
        <div class="image-row">
            <div class="image-item">
                <h4>🔧 Manual</h4>
                <img src="imgs/mosaic_1_complete.png" alt="Manual Mosaic 1" style="width: 100%; height: auto;">
                <div class="caption">Manual homography estimation</div>
            </div>
            <div class="image-item">
                <h4>🤖 Automatic</h4>
                <img src="imgs/automatic_mosaic_3a_final.png" alt="Automatic Mosaic 1" style="width: 100%; height: auto;">
                <div class="caption">MOPS + RANSAC automatic</div>
            </div>
        </div>

        <h4>Mosaic 2: Image 2a ↔ Image 2b</h4>
        <div class="image-row">
            <div class="image-item">
                <h4>🔧 Manual</h4>
                <img src="imgs/mosaic_bilinear_1.png" alt="Manual Mosaic 2" style="width: 100%; height: auto;">
                <div class="caption">Manual homography estimation</div>
            </div>
            <div class="image-item">
                <h4>🤖 Automatic</h4>
                <img src="imgs/automatic_mosaic_1a_final.png" alt="Automatic Mosaic 2" style="width: 100%; height: auto;">
                <div class="caption">MOPS + RANSAC automatic</div>
            </div>
        </div>

        <h4>Mosaic 3: Image 3a ↔ Image 3b</h4>
        <div class="image-row">
            <div class="image-item">
                <h4>🔧 Manual</h4>
                <img src="imgs/mosaic_bilinear_2.png" alt="Manual Mosaic 3" style="width: 100%; height: auto;">
                <div class="caption">Manual homography estimation</div>
            </div>
            <div class="image-item">
                <h4>🤖 Automatic</h4>
                <img src="imgs/automatic_mosaic_2a_final.png" alt="Automatic Mosaic 3" style="width: 100%; height: auto;">
                <div class="caption">MOPS + RANSAC automatic</div>
            </div>
        </div>

        <div class="highlight">
            <h4>Comparison Analysis:</h4>
            <p>The comparison between manual and automatic mosaicing reveals that both approaches achieve comparable visual quality and geometric accuracy. The automatic method demonstrates superior efficiency by eliminating manual point selection, while maintaining robustness across varying lighting conditions and perspective changes. The MOPS algorithm's ability to process multiple image pairs simultaneously makes it particularly advantageous for large-scale panorama creation, representing a significant advancement in computational photography techniques.</p>
        </div>

        <h3>Automatic Mosaics (≥3 Required)</h3>
        <div class="image-container">
            <h4>Automatic Mosaic 1 (Image 1a ↔ Image 1b)</h4>
            <img src="imgs/automatic_mosaic_3a_final.png" alt="Automatic Mosaic 1" style="max-width: 90%;">
            <div class="caption">Automatic mosaic created using MOPS algorithm and RANSAC homography</div>
        </div>

        <div class="image-container">
            <h4>Automatic Mosaic 2 (Image 2a ↔ Image 2b)</h4>
            <img src="imgs/automatic_mosaic_1a_final.png" alt="Automatic Mosaic 2" style="max-width: 90%;">
            <div class="caption">Second automatic mosaic demonstrating robust feature matching</div>
        </div>

        <div class="image-container">
            <h4>Automatic Mosaic 3 (Image 3a ↔ Image 3b)</h4>
            <img src="imgs/automatic_mosaic_2a_final.png" alt="Automatic Mosaic 3" style="max-width: 90%;">
            <div class="caption">Third automatic mosaic showing panoramic stitching capabilities</div>
        </div>
    </div>
    <script src="project3_script.js"></script>
</body>
</html>

